# 项目整体工作流规划

## 目标
构建一个从用户输入（个人 PDF 简历与目标岗位 JD）到输出（针对性优化后的 PDF 简历）的闭环系统，同时保留中间 JSON 数据以便审核、版本管理和二次迭代。

## 阶段划分与优化建议

### 1. 输入采集与预处理
- **上传模块**：接收用户 PDF 简历与 JD 文本/文件，记录元数据（岗位、公司、版本号、上传时间）。
- **简历解析**：使用可靠的 PDF→文本/结构化解析器（如 pdfminer + 版块启发式、LLM 校正）提取内容，按 `resume.json` 的 schema 归档；对于表格、列表项等难解析区域，通过版面分析或引导性 prompt 进行纠正。
- **JD 解析与标准化**：将原始 JD 切分为职责、必备技能、加分项、软技能等类别，构建结构化表示（例如 `responsibilities`, `requirements`, `bonusSkills` 等），便于后续匹配；同时保留原文片段用于回溯。
- **数据校验**：校验 JSON schema 合法性，标记缺失字段，生成初步报告供用户确认或补充。

### 2. 语义对齐与差距分析
- **关键词对齐**：利用嵌入模型或规则，将 JD 中的核心技能/经验与简历中的表述进行比对，标记匹配度、缺失项与可强化点。
- **量化建议生成**：依据 `rule.txt` 的约束预生成优化建议列表（例如“在 Experience.ABC 项目中增加关于数据管道规模的量化表述”）。
- **风险过滤**：提前识别可能违背真实经历、篇幅限制或风格规范的建议，确保后续 LLM 生成有边界。

### 3. LLM 驱动的内容优化
- **提示构造**：将结构化简历 JSON、JD 解析结果、差距分析以及 `rule.txt` 的核心约束整合为系统提示和示例对话，避免 LLM “虚构”经历。
- **迭代生成**：
  1. 先让 LLM 生成修改计划（列出将修改哪些字段、目标是什么）。
  2. 再依据计划输出更新后的 `resume.json`（仅允许在 Experience/Projects/Skills 等可编辑字段内调整）。
  3. 对输出执行自动化校验（字段完整性、篇幅限制、是否新增未授权字段）。
- **人工审阅（可选）**：为重要用户或首轮上线阶段保留人工审核流程，确保质量。

### 4. 渲染与交付
- **PDF 生成**：复用/扩展 `transfer.py`，支持多主题与本地化字体。对 LLM 生成的 JSON 做二次排版检查（长段落分句、项目符号统一）。
- **版本管理**：保存原始 JSON、优化后 JSON、对应 PDF，建立版本号和回滚机制。
- **用户交互**：向用户展示 diff（文本对比或高亮更新项），并允许用户反馈“不满意”触发下一轮迭代。

### 5. 反馈闭环与持续改进
- **指标采集**：统计用户满意度、修改时长、人工干预比例等指标。
- **模型迭代**：根据失败案例调整 Prompt、加入更多 few-shot 示例或微调方案。
- **知识库更新**：沉淀常见岗位的 JD 解析模板与优秀案例，提升后续自动化效果。

## 技术与工程建议
- **模块化设计**：按“解析 → 分析 → 生成 → 渲染”划分服务边界，便于替换特定组件。
- **可观察性**：为每个阶段设计日志与审计记录，尤其是 LLM 输入输出，方便追踪质量问题。
- **安全合规**：处理简历时注意隐私与数据存储策略（加密、访问控制、数据留存策略）。

以上流程兼顾了自动化与可控性，可作为后续产品化实现的基础蓝图。
